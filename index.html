<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Imperial Cyber-General Dashboard</title>
    <style>
        body { background: #000; color: #00ff41; font-family: 'Courier New', monospace; padding: 20px; }
        .radar-box { border: 1px solid #00ff41; padding: 15px; margin-bottom: 20px; box-shadow: 0 0 10px #00ff41; min-height: 100px; }
        .button-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 5px; }
        button { background: #001100; color: #00ff41; border: 1px solid #00ff41; cursor: pointer; padding: 8px; font-size: 10px; }
        button:hover { background: #00ff41; color: #000; }
        .log-entry { font-size: 0.9em; margin: 5px 0; border-bottom: 1px solid #004400; }
    </style>
</head>
<body>
    <h1>GENERAL COMMAND CENTER v11.0</h1>
    <div id="status-display" style="color: yellow;">Status: STANDBY / جاهز</div>
    
    <div class="radar-box">
        <h3 style="margin-top:0;">LIVE RADAR FEED / رادارات الرصد</h3>
        <div id="radar-logs"></div>
    </div>

    <h3>TACTICAL MODULES (P1 - P70)</h3>
    <div class="button-grid" id="btn-grid"></div>

    <script>
        let isProcessing = false;
        const GRID = document.getElementById('btn-grid');
        const LOGS = document.getElementById('radar-logs');

        for(let i=1; i<=70; i++) {
            let btn = document.createElement('button');
            btn.innerText = 'P' + i;
            btn.onclick = () => executeProtocol('P' + i);
            GRID.appendChild(btn);
        }

        async function executeProtocol(pCode) {
            if (isProcessing) return;
            isProcessing = true;
            document.getElementById('status-display').innerText = `EXECUTING ${pCode}...`;
            
            try {
                // الربط المباشر مع المسار المعتمد في vercel.json
                const response = await fetch('/api/general?p_code=' + pCode);
                const data = await response.json();
                
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                entry.innerHTML = `[${new Date().toLocaleTimeString()}] > ${data.title}: ${data.data}`;
                LOGS.prepend(entry);
                
                if (LOGS.childNodes.length > 8) LOGS.removeChild(LOGS.lastChild);
            } catch (err) {
                console.error("Connection Error");
            } finally {
                setTimeout(() => { 
                    isProcessing = false; 
                    document.getElementById('status-display').innerText = "Status: ONLINE / سيادة كاملة";
                }, 3000);
            }
        }

        // رادار تلقائي آمن
        setInterval(() => { if(!isProcessing) executeProtocol('P1'); }, 15000);
    </script>
</body>
</html>
